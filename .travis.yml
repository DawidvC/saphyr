language: cpp

matrix:
   include:
    - compiler: clang
      env: REPO=trusty
    - compiler: clang
      env: REPO=utopic
    - compiler: clang
      env: REPO=vivid
    - compiler: gcc
      env: COVERAGE=true REPO=trusty

before_install:
 - sudo cp /etc/apt/sources.list /etc/apt/sources.list.d/$REPO.list
 - sudo sed -i 's/precise/$REPO/g' /etc/apt/sources.list.d/$REPO.list
 - export CXX_PKG=$(if [[ $CXX == "g++" ]]; then echo "g++"; fi)
 - sudo apt-get update -qq
 - sudo apt-get install -qq -y flexc++ bisonc++ llvm-dev $CXX_PKG python3 libboost-program-options-dev
 - if [[ $CXX == "g++" ]]; then sudo pip install cpp-coveralls; fi

script: make tests

after_success:
 - coveralls --gcov-options '\-lp' -t $COV_TOKEN -e scanner.cpp -e scanner.h -e scannerbase.h -e parser.cpp -e parser.h -e parser.ih -e parserbase.h
